<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Timers</title>
  <style>

    html, body {
      height: 100%;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
      font-family: sans-serif;
      font-weight: 700;
      background-color: #000;
      color: #fff;
    }

    .timer-container {
      display: grid;
      gap: 20px;
      height: 100%;
      width: 100%;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      align-items: stretch;
    }

    .timer-module {
      background: #111;
      border: 4px solid #444;
      border-radius: 10px;
      box-shadow: 0 0 10px #008cff;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      text-align: center;
    }

    .label {
      font-size: clamp(1.5rem, 3vw, 4rem);
      color: #FFFFFF;
      margin-bottom: 10px;
    }

    .time {
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(3rem, 10vw, 12rem);
      color: #ffffff;
    }

    .controls {
      margin-top: 20px;
    }

    .controls button {
      background-color: #222;
      color: #ccc;
      font-family: sans-serif;
      font-weight: 700;
      border: 1px solid #555;
      padding: clamp(6px, 1vw, 12px) clamp(10px, 2vw, 20px);
      font-size: clamp(0.8rem, 1.5vw, 1.2rem);
      border-radius: 4px;
      cursor: pointer;
      margin: 0 5px;
      transition: background-color 0.2s, color 0.2s;
    }

    .controls button:hover {
      background-color: #333;
      color: #fff;
    }
  </style>
</head>
<body>

  <div class="timer-container">

    <!-- Timer 1 -->
    <div class="timer-module" data-minutes="10" data-label="Discussion Time" data-next="timer2">
      <div class="label">Discussion</div>
      <div class="time">10:00</div>
      <div class="controls">
        <button class="start-btn">START</button>
        <button class="reset-btn">RESET</button>
      </div>
    </div>

    <!-- Timer 2 -->
    <div class="timer-module" id="timer2" data-minutes="10" data-label="Prayer Time">
      <div class="label">Prayer</div>
      <div class="time">10:00</div>
      <div class="controls">
        <button class="start-btn">START</button>
        <button class="reset-btn">RESET</button>
      </div>
    </div>

  </div>

  <script>
    function playBeep(isFinal = false) {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = ctx.createOscillator();
        const gain = ctx.createGain();
        oscillator.type = "sine";
        oscillator.frequency.setValueAtTime(isFinal ? 1000 : 500, ctx.currentTime); // higher pitch on final beep
        gain.gain.setValueAtTime(0.1, ctx.currentTime);
        oscillator.connect(gain);
        gain.connect(ctx.destination);
        oscillator.start();
        oscillator.stop(ctx.currentTime + (isFinal ? 0.6 : 0.2));
    }

    document.addEventListener("DOMContentLoaded", () => {
      const timerModules = document.querySelectorAll(".timer-module");

      timerModules.forEach((module, index) => {
        const minutes = parseFloat(module.getAttribute("data-minutes")) || 1;
        const nextTimerId = module.getAttribute("data-next");
        const timeDisplay = module.querySelector(".time");
        const startBtn = module.querySelector(".start-btn");
        const resetBtn = module.querySelector(".reset-btn");

        let totalSeconds = Math.floor(minutes * 60);
        let remainingSeconds = totalSeconds;
        let timerInterval = null;

        function formatTime(secs) {
          const m = String(Math.floor(secs / 60)).padStart(2, '0');
          const s = String(secs % 60).padStart(2, '0');
          return `${m}:${s}`;
        }

        function updateDisplay() {
          timeDisplay.textContent = formatTime(remainingSeconds);
        }

        function startTimer() {
          if (timerInterval) return;
          timerInterval = setInterval(() => {
            if (remainingSeconds > 0) {
                remainingSeconds--;
                if (remainingSeconds <= 5 && remainingSeconds > 0) {
                playBeep();
                } else if (remainingSeconds === 0) {
                playBeep(true); // higher final beep
                }
                updateDisplay();
            } else {
                clearInterval(timerInterval);
                timerInterval = null;
                module.style.borderColor = "#05ff61";

                if (nextTimerId) {
                const next = document.getElementById(nextTimerId);
                if (next) {
                    const nextStart = next.querySelector(".start-btn");
                    nextStart.click();
                }
                }
            }
          }, 1000);
        }

        function resetTimer() {
          clearInterval(timerInterval);
          timerInterval = null;
          remainingSeconds = totalSeconds;
          updateDisplay();
          module.style.borderColor = "#444";
        }

        startBtn.addEventListener("click", startTimer);
        resetBtn.addEventListener("click", resetTimer);

        updateDisplay();
      });

      // Wake Lock Integration
      let wakeLock = null;

      async function requestWakeLock() {
        try {
          if ('wakeLock' in navigator) {
            wakeLock = await navigator.wakeLock.request('screen');
            console.log('Wake Lock is active');
            wakeLock.addEventListener('release', () => {
              console.log('Wake Lock was released');
            });
          } else {
            console.warn('Wake Lock API not supported in this browser.');
          }
        } catch (err) {
          console.error(`Wake Lock request failed: ${err.name}, ${err.message}`);
        }
      }

      // Request wake lock on page load
      requestWakeLock();

      // Re-request wake lock when returning to tab
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
          requestWakeLock();
        }
      });
    });
  </script>
</body>
</html>
